<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../app-route/app-location.html">
<link rel="import" href="../app-route/app-route.html">
<link rel="import" href="../iron-pages/iron-pages.html">

<link rel="import" href="../iron-ajax/iron-ajax.html">

<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-item/paper-item.html">

<link rel="import" href="../util/hnk-base.html">
<link rel="import" href="../util/hnk-config.html">
<link rel="import" href="../util/shared-styles.html">

<link rel="import" href="../pages/hnk-page.html">
<link rel="import" href="../pages/hnk-nuevaencuesta-page.html">
<link rel="import" href="../pages/hnk-encuesta-page.html">
<link rel="import" href="../pages/hnk-encuestas-page.html">

<dom-module id="encuestas-heineken-app">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
             }

        </style>

        <!-- app-location binds to the app's URL -->
        <app-location use-hash-as-path route="{{route}}"></app-location>

        <!-- this app-route manages the top-level routes -->
        <app-route
                id="router"
                route="{{route}}"
                pattern="/:view"
                data="{{routeData}}"
                tail="{{subroute}}"></app-route>

        <iron-ajax id="ajaxConfig" url="/config" handle-as="json" last-response="{{config}}" auto></iron-ajax>
        <iron-ajax id="ajaxUsuario" url="[[url]]" handle-as="json" on-response="_onResponseUsuarios" auto></iron-ajax>

        <hnk-page
            id="pagina"
            usuario="[[usuario]]"
            mostrar-spinner="[[mostrarSpinner]]"
        >
            <iron-pages selected="[[routeData.view]]" attr-for-selected="name" on-iron-select="_onPageSelected">
                <hnk-nuevaencuesta-page
                    name="nueva_encuesta"
                    usuario="[[usuario]]"
                    route="{{subroute}}"
                    cargando="{{mostrarSpinner}}"
                ></hnk-nuevaencuesta-page>
                <hnk-encuesta-page
                    name="encuesta"
                    usuario="[[usuario]]"
                    route="{{subroute}}"
                    cargando="{{mostrarSpinner}}"
                ></hnk-encuesta-page>
                <hnk-encuestas-page
                    name="encuestas"
                    usuario="[[usuario]]"
                    route="{{subroute}}"
                    cargando="{{mostrarSpinner}}"
                ></hnk-encuestas-page>
        </iron-pages>
        </hnk-page>
    </template>

    <script>
        Polymer({

            is: 'encuestas-heineken-app',
            behaviors: [hnk.BaseBehavior, hnk.ConfigBehavior],
            properties: {
                usuario: {
                    type: Object
                },
                url: String
            },
            ready: function() {
                this.getUrl(this, 'usuarios')
                        .then(function(url) {
                            this.url = url;
                        }.bind(this));
            },
            _onPageSelected: function(e, model) {
                this.$.pagina.reiniciar();
                model.item.reiniciar && model.item.reiniciar();
            },
            _onResponseUsuarios: function(e, detail) {
                this.usuario = e.detail.response[0];
            }
        });
    </script>
</dom-module>,

