<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../app-route/app-route.html">

<link rel="import" href="../iron-ajax/iron-ajax.html">

<link rel="import" href="../encuestas/hnk-encuesta.html">

<link rel="import" href="hnk-page.html">

<link rel="import" href="../util/hnk-base.html">
<link rel="import" href="../util/hnk-config.html">
<link rel="import" href="../util/shared-styles.html">

<dom-module id="hnk-encuesta-page">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }
        </style>

        <app-route
                route="{{route}}"
                pattern="/:_id"
                data="{{routeData}}"></app-route>

        <hnk-encuesta
            encuesta="{{encuesta}}"
            on-volver="_onVolver"
        ></hnk-encuesta>

        <iron-ajax
            id="ajax"
            method="get"
            url="[[url]]"
            content-type="application/json"
            last-response="{{encuesta}}"
            auto
        ></iron-ajax>

    </template>

    <script>
        Polymer({
            is: 'hnk-encuesta-page',
            behaviors: [hnk.BaseBehavior, hnk.ConfigBehavior],
            properties: {
                url: String,
                encuesta: {
                    type: Object,
                    value: function(){return {id: 1, datos: {local: 'Garito'}, usuario: {id: 1, nombre: 'Saúl Gutiérrez Santamaría', supervisor: false}, encuesta: [{id: 1, titulo: 'Grupo 1', preguntas: [{id:1, titulo:'Pregunta 1', respuestas: [{"id":1,"texto":"Uno"},{"id":2,"texto":"Dos"}], respuesta: null},
                        {id:2, titulo:'Pregunta 2', respuestas: [{"id":3,"texto":"Tres"},{"id":4,"texto":"Cuatro"}], respuesta: null}]},
                        {id: 2, titulo: 'Grupo 2', preguntas: [{id:3, titulo:'Pregunta 3', respuestas: [{"id":5,"texto":"Cinco"},{"id":6,"texto":"Seis"}], respuesta: null},
                            {id:4, titulo:'Pregunta 4', respuestas: [{"id":7,"texto":"Siete"},{"id":8,"texto":"Ocho"}], respuesta: null}]}]}}
                }
            },
            observers: ['_observerrouteData(routeData)'],
            _observerrouteData: function(routeData, routeData2) {
                console.log('1', routeData);
                console.log('2', routeData2);
                if (routeData._id) {
                    this.getUrl(this, 'encuesta', routeData._id)
                            .then(function(url) {
                                this.url = url;
                            }.bind(this));
                }
            },
            _onAvanzar: function() {
                this._setEstado(this.estado + 1);
            },
            _onVolver: function(e) {
                e.stopPropagation();
                if (this.estado) {
                    this._setEstado(this.estado - 1);
                } else {
                    this.fire('volver');
                }
            }
        });
    </script>
</dom-module>
